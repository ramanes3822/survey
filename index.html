<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Survey-Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    
    <div class="banner">
      <img src="assets/sample2.png" alt="banner image">
    </div>
    <div class="rewards-text"><p>Submit to get rewards</p></div>
    <div class="form-container">
      <form id="register-form" action="https://5679-175-139-147-209.ngrok-free.app/api/smart-engage/post/get-rewards-line" method="post">
        <input type="hidden" name="coupon-id" value="569">
        <label for="country-code">Country code:</label>
        <select id="country-code" name="country-code">
          <option value="65">Singapore(+65)</option>
          <option value="852">Hong Kong (+852)</option>
          <option value="81">Japan (+81)</option>
          <option value="60">Malaysia (+60)</option>
        </select>
        <label for="phone-number">Phone number:</label>
        <input type="text" id="phone-number" name="phone-number" placeholder="Enter phone number">
        <input type="submit" value="Submit">
      </form>
      <div id="response-message"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      $(document).ready(function(){
        $('#register-form').submit(function(event){
          event.preventDefault();
          const countryCode = $('#country-code').val();
          const phoneNumber = $('#phone-number').val();
          const fullPhoneNumber = countryCode + phoneNumber;
          const formData = {
            'coupon-id': $('#register-form').find('input[name="coupon-id"]').val(),
            'phone-number': fullPhoneNumber,
            'type': 'redeem_request'
          }
          $.ajax({
            type: 'POST',
            url: $('#register-form').attr('action'),
            data: JSON.stringify(formData),
            success: function(response){
              console.log(response);
              if (response.ok) {
                console.log(response.url);
                window.location.href = response.url;
              } else {
                $('#response-message').html(response.message);
              }
            },error: function(response){
              console.log(response);
            }
          })
        })
      })
      // const form = document.getElementById('register-form')
      // const responseMessage = document.getElementById('response-message')

      // form.addEventListener('submit', async(event)=>{
      //   event.preventDefault();

      //   //concatenate country code and phone number
      //   const countryCode = document.getElementById('country-code').value;
      //   const phoneNumber = document.getElementById('phone-number').value;
      //   const fullPhoneNumber = countryCode + phoneNumber;

      //   const formData = {
      //     'coupon-id': form.elements['coupon-id'].value,
      //     'phone-number': fullPhoneNumber,
      //     'type': 'redeem_request'
      //   }
      //    const response = await fetch(form.action, {
      //     method: 'POST',
      //     headers: {
      //       'Content-Type': 'application/json'
      //     },
      //     body: JSON.stringify(formData),
      //   });
      //   const result = await response.json();
      //   if (response.ok) {
      //     window.location.href = result.url;
      //   } else {
      //     console.log(result.message);
      //   }
      // })
    </script>

  </body>
</html>
